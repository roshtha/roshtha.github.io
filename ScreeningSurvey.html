<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cancer Screening Survey Form</title>
	<link rel="stylesheet" type="text/css" href="scripts/assets/css/ScreeningSurvey.css">
	<link rel="manifest" href="manifest.json">
	<script src="scripts/dexie/dexie.min.js"></script>
	<script src="scripts/dexie/dexie.js"></script>	
	<script src="scripts/js/gone-offline.js"></script>	
	<!--iOS support-->
	<link rel="apple-touch-icon" href="icons/icon-96.png">
	<meta name="apple-mobile-web-app-status-bar" content="#00695c">
	<meta name="theme-color" content="#00695c">
	
	<!--iOS support-->		
</head>




<body>
	<div class="container">

		<div class="title">
			Cancer Screening Survey 
			<p style="float: right;"><a href="Menu.html">Menu</a></p> 
		</div>
		
		<div id="status"></div>
		<div class="form">
			<form name="personForm">	
			<div class="input-field">
				<label>1.Education</label>
				<div class="custom_select">
				<select id="education">
					<option>Select</option>
					<option>Illiterate</option>
					<option>Less than matriculate</option>
					<option>Matriculate</option>
					<option>Intermediate</option>
					<option>Diploma</option>
					<option>Grdauate</option>
				</select>
				</div>
			</div>

			<div class="input-field">
				<label>2.Job</label>
				<div class="custom_select">
				<select id="job">
					<option>Select</option>
					<option>Jobless</option>
					<option>Daily Workers</option>
					<option>Business</option>
					<option>Private Job</option>
					<option>Government Service</option>								
				</select>
				</div>
			</div>

			<div class="input-field">
				<label>3.Monthly Income</label>
				<div class="custom_select">
				<select id="income">
					<option>Select</option>
					<option>< Rs. 10000</option>
					<option>Rs. 10000 to 30000></option>					
					<option>> Rs. 50000</option>
					<option>> Rs. 1 Lakh</option>
				</select>
				</div>
			</div>

			<div class="input-field">
				<label>4.Food Habits</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="food" id="food">Veg
		                    <input type="radio" name="food" id="food">Non-veg
		                </td>															
            		</tr>
				</table>
			</div>						

			<div class="input-field">
				<label>5.Currently a cancer patient?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="currentstatus" id="currentstatus">Yes
		                    <input type="radio" name="currentstatus" id="currentstatus">No
		                </td>															
            		</tr>
				</table>
			</div>	

			<div class="input-field">
				<label>6.Any other serious illness?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="anyotherillness" id="anyotherillness">Yes
		                    <input type="radio" name="anyotherillness" id="anyotherillness">No
		                </td>															
            		</tr>
				</table>
			</div>

			<div class="input-field">
				<label>7.Any cancer death in the family?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="cancerdeath" id="cancerdeath">Yes
		                    <input type="radio" name="cancerdeath" id="cancerdeath">No
		                </td>															
            		</tr>
				</table>
			</div>

			<div class="input-field">
				<label>8.Has anybody from the family registered at RCC?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="registeredinRCC" id="registeredinRCC">Yes
		                    <input type="radio" name="registeredinRCC" id="registeredinRCC">No
		                </td>															
            		</tr>
				</table>
			</div>	

			<div class="input-field">
				<label>9.Do you smoke?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="smoke" id="smoke">Yes
		                    <input type="radio" name="smoke" id="smoke">No
		                </td>															
            		</tr>
				</table>
			</div>	

			<div class="input-field">
				<label>10.Do you chew tobacco?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="tobacco" id="tobacco">Yes
		                    <input type="radio" name="tobacco" id="tobacco">No
		                </td>															
            		</tr>
				</table>
			</div>	

			<div class="input-field">
				<label>11.Do you drink alcohol?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="alcohol" id="alcohol">Yes
		                    <input type="radio" name="alcohol" id="alcohol">No
		                </td>															
            		</tr>
				</table>
			</div>			

			<div class="btn-field">
				<!-- <input type="submit" style='margin-right:16px' class="btn" value="SUBMIT">
				<input type="button" class="btn" value="CLEAR">
				<input type="button" class="btn" id="nextbutton" value=">>"> -->

				<input type="button" class="btn" id="prevbutton" onclick="MainPageFn()" value="<<">
				<!-- <input type="submit" style='margin-right:16px' class="btn" id="submit" value="SUBMIT"> -->			
				<button id="submit" class="btn">SAVE</button>				
				<input type="button" class="btn" value="CLEAR">
				<input type="button" class="btn" id="nextbutton" onclick="OralFn()" value=">>">
			</div>	
			</form>				
			<div id="output" style="margin-top:20px;"></div>
		</div>
		
	</div>
	<script>
		function MainPageFn() {
			document.location.href="Menu.html"; 
		}
		
		function OralFn() {
			document.location.href="Oral.html"; /*Page name or Path*/ 
		}
	</script>

			<script>
			
			//OLD CODE STARTS ----------------------------------------
			
			/*var db = new Dexie("DigiPathoFSDB");
			
			db.version(1).stores({
				fs_cancer_screening: "++fs_person_id, fs_cancer_id, education_id, job_id, monthly_income, food_habits, cancer_patient, serious_illness, cancer_death, registered_at_rcc, smoke, tobacco, alcohol, user_id, created_date, is_valid"
			});
			
			//Log DB details -- opens an existing database as is
			db.open();*/
			
			/*var db = new Dexie("DigiPathoFSDB")
			  .open()
			  .then(function (db) {
			    console.log("Found database: " + db.name);
			    console.log("Database version: " + db.verno);
			    db.tables.forEach(function (table) {
			      console.log("Found table: " + table.name);
			      console.log("Table Schema: " + JSON.stringify(table.schema, null, 4));
			    });
			  })
			  .catch("NoSuchDatabaseError", function (e) {
			    // Database with that name did not exist
			    console.error("Database not found");
			  })
			  .catch(function (e) {
			    console.error("Oh uh: " + e);
			  });
			
			function add_new(education, job, income, food, currentstatus, anyotherillness, cancerdeath, registeredinRCC, smoke, tobacco, alcohol){
			    // Interact With Database
			    db.transaction('rw', db.fs_cancer_screening, function () {
			        // Let's add some data to db:
			        insert_object = {
			        					education_id:education, job_id:job, monthly_income:income, food_habits:food, cancer_patient:currentstatus, serious_illness:anyotherillness, cancer_death:cancerdeath, registered_at_rcc:registeredinRCC, smoke:smoke, tobacco:tobacco, alcohol:alcohol    												
									};
			        db.fs_cancer_screening.add(insert_object);
			    }).catch(function(err) {
			        console.error(err.stack || err);
			        console.log("ERROR");
			    });    
			}*/



			//add_new("susheel singh","susheel61@gmail.com");//default content
			//add_new("susheel singh","1987-09-28","35","Female","Married","944778932","SH2, Sulthan Bathery","4565545654","WARD2","PANCH5","DIST14","STA28","IND","689542","Doctor1","2022-09-27",true);//default content
			/*document.querySelector("button").addEventListener("click",function(e){
				//document.getElementById('submit').addEventListener('click', function (event) {
					//preventing default submission of the form
					//event.preventDefault();
					//console.log("Default event prevented!!!!");
					//console.log("button clicked");
			    add_new(
			    			document.getElementById('education').value,
			    			document.getElementById('job').value,
			    			document.getElementById('income').value,
			    			document.getElementById('food').checked,
			    			document.getElementById('currentstatus').checked,
			    			document.getElementById('anyotherillness').checked,
			    			document.getElementById('cancerdeath').checked,
			    			document.getElementById('registeredinRCC').checked,
			    			document.getElementById('smoke').checked,
			    			document.getElementById('tobacco').checked,
			    			document.getElementById('alcohol').checked
			    			
			    			Number(document.getElementById('food').checked),
			    			Number(document.getElementById('currentstatus').checked),
			    			Number(document.getElementById('anyotherillness').checked),
			    			Number(document.getElementById('cancerdeath').checked),
			    			Number(document.getElementById('registeredinRCC').checked),
			    			Number(document.getElementById('smoke').checked),
			    			Number(document.getElementById('tobacco').checked),
			    			Number(document.getElementById('alcohol').checked)
					);
			});*/
			
			
			//OLD CODE ENDS ----------------------------------------
			
					console.log("inside oral survey html script tag, for idb working");
		  
		//opening already created IDB
		var db = new Dexie("DigiPathoFSDB")
		  .open()
		  .then(function (db) {
		    console.log("Found database: " + db.name);
		    console.log("Database version: " + db.verno);
		    db.tables.forEach(function (table) {
		      console.log("Found table: " + table.name);
		      console.log("Table Schema: " + JSON.stringify(table.schema, null, 4));
		    });
		  })
		  .catch("NoSuchDatabaseError", function (e) {
		    // Database with that name did not exist
		    console.error("Database not found");
		  })
		  .catch(function (e) {
		    console.error("Oh uh: " + e);
		  });
		
		
			
			// form send event listener
			document.getElementById('submit').addEventListener('click', function (event) {
				//preventing default submission of the form
				event.preventDefault();
				console.log("Default event prevented!!!!");
				
			
				function add_new(education, job, income, food, currentstatus, anyotherillness, cancerdeath, registeredinRCC, smoke, tobacco, alcohol){
				    // Interact With Database, fs_cervical_cancer_screening is one of the field names of IDB
				    db.transaction('rw', db.fs_cancer_screening_sync, function () {
				        // Let's add some data to db:
				        insert_object = {
				        					education_id:education, job_id:job, monthly_income:income, food_habits:food, 
				        					cancer_patient:currentstatus, serious_illness:anyotherillness, cancer_death:cancerdeath, 
				        					registered_at_rcc:registeredinRCC, smoke:smoke, tobacco:tobacco, alcohol:alcohol    												
										};
				        db.fs_cancer_screening_sync.add(insert_object);
				    }).catch(function(err) {
				        console.error(err.stack || err);
				        console.log("ERROR OCCURRED when calling the form values and mappping with IDB fields");
				    });    
				}
			    

			//Background Sync code 
			
			//if the browser supports both serviceWorker and SyncManager, then carry on the further steps
			/*if ('serviceWorker' in navigator && 'SyncManager' in window) {
	                                    console.log("SYNC MANAGER AVAILABLE");
	                                  
	                                    // serviceWorker registered at top of page       
	                                    navigator.serviceWorker.ready.then(function (swRegistration) {
	                                        console.log("register sync fs_cancer_screening_sync_tag");
	                                        // REGISTER SYNC EVENT called fs_cancer_screening_sync_tag(our own custom name which should be unique to this particular background sync)
	                                        swRegistration.sync.register('fs_cancer_screening_sync_tag');*/

	                                        console.log("Saving to idb")
	                                        //writing data into IDB, function of idb-fn.js
	                                        //writeData("fs_person_reg", personData);	//fs_person_reg is table i.e store name
	                                        
	                                        //getting all the fields
										    add_new(
										    			document.getElementById('education').value,
										    			document.getElementById('job').value,
										    			document.getElementById('income').value,										    			
										    			Number(document.getElementById('food').checked),
										    			Number(document.getElementById('currentstatus').checked),
										    			Number(document.getElementById('anyotherillness').checked),
										    			Number(document.getElementById('cancerdeath').checked),
										    			Number(document.getElementById('registeredinRCC').checked),
										    			Number(document.getElementById('smoke').checked),
										    			Number(document.getElementById('tobacco').checked),
										    			Number(document.getElementById('alcohol').checked)
												);
											
	                                        console.log("Cancer Screening Data stored in idb...");
	                                        // if online it will be sent immediately by sync event and    
	                                        //if not online, display some proper message in the div id named 'output' 
	                                        if (!navigator.onLine) {
	                                            const output = document.getElementById('output');
	                                            output.innerHTML =
	                                                "FORM DATA SAVED AND WILL BE SENT LATER WHEN BACK ONLINE";
	                                            output.style.border = '2px solid red';
	                                            output.style.color = 'blue';
	                                            console.log("OFFLINE - so, if block worked");
	                                        } else {		//otherwise, if online, automatically synced 
	                                            // TO DO
	                                            // post form as we are online
	                                            const output = document.getElementById('output');
	                                            output.innerHTML =
	                                                "FORM DATA SENT";
	                                           output.style.border = '2px solid avocado';
	                                           output.style.color = 'green';
	                                           console.log("ONLINE - So, else block worked, data directly sent.");
	                                        }
	                                    });
	                                } else {
	                                	//if the browser does not support both serviceWorker and SyncManager, then post the form in a regular way
	                                    console.log("Browser does not support serviceWorker and SyncManager");
	                                	alert("does not support offline capability!!!!");
	                                }	
				

			});
			
	</script>
	
		<!-- <script src="scripts/js/app.js"></script>  -->
 	<script type="text/javascript" src="scripts/js/promise.js"></script>
	<script type="text/javascript" src="scripts/js/fetch.js"></script>
	<script type="text/javascript" src="scripts/js/app.js"></script>	
	<script type="module" src="scripts/js/ssapp.js"></script>
	<script src="scripts/js/idb-init.js"></script>

</body>
</html>