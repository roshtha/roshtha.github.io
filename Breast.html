<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Breast Cancer Screening Survey Form</title>
	<link rel="stylesheet" type="text/css" href="scripts/assets/css/Breast.css">
	<link rel="manifest" href="manifest.json">
	<script src="scripts/dexie/dexie.min.js"></script>
	<script src="scripts/dexie/dexie.js"></script>	
	<script src="scripts/js/gone-offline.js"></script>		
	<!--iOS support-->
	<link rel="apple-touch-icon" href="icons/icon-96.png">
	<meta name="apple-mobile-web-app-status-bar" content="#00695c">
	<meta name="theme-color" content="#00695c">
	<!--iOS support-->		
</head>




<body>
	<div class="container">

		<div class="title">
			Breast Cancer Screening 
			<p style="float: right;"><a href="Menu.html">Menu</a></p>			
		</div>
		
		<div id="status"></div>
		<div class="form">
			<form name="patientForm">
			<div class="input-field">
				<label>1.Is there a skin difference in the breasts?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="breast1" id="breast1">Yes
		                    <input type="radio" name="breast1" id="breast1">No
		                </td>															
            		</tr>
				</table>
			</div>						

			<div class="input-field">
				<label>2.Have lumps in the breasts?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="breast2" id="breast2">Yes
		                    <input type="radio" name="breast2" id="breast2">No
		                </td>															
            		</tr>
				</table>
			</div>	

			<div class="input-field">
				<label>3.Are the breasts swollen?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="breast3" id="breast3">Yes
		                    <input type="radio" name="breast3" id="breast3">No
		                </td>															
            		</tr>
				</table>
			</div>

			<div class="input-field">
				<label>4.Is there abnormal nipple discharge?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="breast4" id="breast4">Yes
		                    <input type="radio" name="breast4" id="breast4">No
		                </td>															
            		</tr>
				</table>
			</div>		

			<div class="input-field">
				<label>5.Do you have pain in your breasts?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="breast5" id="breast5">Yes
		                    <input type="radio" name="breast5" id="breast5">No
		                </td>															
            		</tr>
				</table>
			</div>

			<div class="input-field">
				<label>6.Are the nipples sore or enlarged?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="breast6" id="breast6">Yes
		                    <input type="radio" name="breast6" id="breast6">No
		                </td>															
            		</tr>
				</table>
			</div>		

			<div class="input-field">
				<label>7.Is there anything palpable in the auxiliary lymph node?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="breast7" id="breast7">Yes
		                    <input type="radio" name="breast7" id="breast7">No
		                </td>															
            		</tr>
				</table>
			</div>						

			<div class="btn-field">
				<input type="button" class="btn" id="prevbutton" onclick="BreastFn()" value="<<">
				<!-- <input type="submit" style='margin-right:16px' class="btn" value="SUBMIT">  -->
				<button id="submit" class="btn">SAVE</button>
				<input type="button" class="btn" value="CLEAR">
				<input type="button" class="btn" id="nextbutton" onclick="OthersFn()" value=">>"> 
			</div>	
			</form>
			<div id="output" style="margin-top:20px;"></div>					
		</div>
	</div>
	<script>
		function CervicalFn() {
			document.location.href="Cervical.html"; 
		}
		
		function OthersFn() {
			document.location.href="Others.html"; /*Page name or Path*/ 
		}
	</script>	

	<script>
	
			//OLD CODE STARTS ----------------------------------------
			
			/*var db = new Dexie("DigiPathoFSDB");
			
			db.version(1).stores({
				fs_breast_cancer_screening: "++fs_person_id, fs_cancer_id, skin_difference, lumps_present, is_swollen, discharge_abnormality, is_pain, is_enlarged, is_palpable, user_id, created_date, is_valid"
			});
			
			//Log DB details -- opens an existing database as is
			db.open(); */
			
			/*var db = new Dexie("DigiPathoFSDB")
			  .open()
			  .then(function (db) {
			    console.log("Found database: " + db.name);
			    console.log("Database version: " + db.verno);
			    db.tables.forEach(function (table) {
			      console.log("Found table: " + table.name);
			      console.log("Table Schema: " + JSON.stringify(table.schema, null, 4));
			    });
			  })
			  .catch("NoSuchDatabaseError", function (e) {
			    // Database with that name did not exist
			    console.error("Database not found");
			  })
			  .catch(function (e) {
			    console.error("Oh uh: " + e);
			  });
			
			function add_new(breast1, breast2, breast3, breast4, breast5, breast6, breast7){
			    // Interact With Database
			    db.transaction('rw', db.fs_breast_cancer_screening, function () {
			        // Let's add some data to db:
			        insert_object = {
			        					skin_difference:breast1, lumps_present:breast2, is_swollen:breast3, 
			        					discharge_abnormality:breast4, is_pain:breast5, is_enlarged:breast6, 
			        					is_palpable:breast7								
									};
			        db.fs_breast_cancer_screening.add(insert_object);
			    }).catch(function(err) {
			        console.error(err.stack || err);
			        console.log("ERROR");
			    });    
			}*/



			//add_new("susheel singh","susheel61@gmail.com");//default content
			//add_new("susheel singh","1987-09-28","35","Female","Married","944778932","SH2, Sulthan Bathery","4565545654","WARD2","PANCH5","DIST14","STA28","IND","689542","Doctor1","2022-09-27",true);//default content
			/*document.querySelector("button").addEventListener("click",function(e){
				//document.getElementById('submit').addEventListener('click', function (event) {
					//preventing default submission of the form
					//event.preventDefault();
					//console.log("Default event prevented!!!!");
					//console.log("button clicked");
			    add_new(
			    		document.getElementById('breast1').checked,
			    		document.getElementById('breast2').checked,
			    		document.getElementById('breast3').checked,
			    		document.getElementById('breast4').checked,
			    		document.getElementById('breast5').checked,
			    		document.getElementById('breast6').checked,
			    		document.getElementById('breast7').checked
			    		Number(document.getElementById('breast1').checked),
			    		Number(document.getElementById('breast2').checked),
			    		Number(document.getElementById('breast3').checked),
			    		Number(document.getElementById('breast4').checked),
			    		Number(document.getElementById('breast5').checked),
			    		Number(document.getElementById('breast6').checked),
			    		Number(document.getElementById('breast7').checked)
					);
			});*/
			
			//OLD CODE ENDS ----------------------------------------
			
		console.log("inside breast survey html script tag, for idb working");
		  
		//opening already created IDB
		var db = new Dexie("DigiPathoFSDB")
		  .open()
		  .then(function (db) {
		    console.log("Found database: " + db.name);
		    console.log("Database version: " + db.verno);
		    db.tables.forEach(function (table) {
		      console.log("Found table: " + table.name);
		      console.log("Table Schema: " + JSON.stringify(table.schema, null, 4));
		    });
		  })
		  .catch("NoSuchDatabaseError", function (e) {
		    // Database with that name did not exist
		    console.error("Database not found");
		  })
		  .catch(function (e) {
		    console.error("Oh uh: " + e);
		  });
		
		
			
			// form send event listener
			document.getElementById('submit').addEventListener('click', function (event) {
				//preventing default submission of the form
				event.preventDefault();
				console.log("Default event prevented!!!!");
				
			
				function add_new(breast1, breast2, breast3, breast4, breast5, breast6, breast7){
				    // Interact With Database, fs_breast_cancer_screening is one of the field names of IDB
				    db.transaction('rw', db.fs_breast_cancer_screening_sync, function () {
				        // Let's add some data to db:
				        insert_object = {
				        					skin_difference:breast1, lumps_present:breast2, is_swollen:breast3, 
				        					discharge_abnormality:breast4, is_pain:breast5, is_enlarged:breast6, 
				        					is_palpable:breast7								
										};
				        db.fs_breast_cancer_screening_sync.add(insert_object);
				    }).catch(function(err) {
				        console.error(err.stack || err);
				        console.log("ERROR OCCURRED when calling the form values and mappping with IDB fields");
				    });    
				}
			    

			//Background Sync code 
			
			//if the browser supports both serviceWorker and SyncManager, then carry on the further steps
			if ('serviceWorker' in navigator && 'SyncManager' in window) {
	                                    console.log("SYNC MANAGER AVAILABLE");
	                                  
	                                    // serviceWorker registered at top of page       
	                                    navigator.serviceWorker.ready.then(function (swRegistration) {
	                                        console.log("register sync fs_breast_cancer_screening_sync_tag");
	                                        // REGISTER SYNC EVENT called fs_breast_cancer_screening_sync_tag(our own custom name which should be unique to this particular background sync)
	                                        swRegistration.sync.register('fs_breast_cancer_screening_sync_tag');

	                                        console.log("Saving to idb")
	                                        //writing data into IDB, function of idb-fn.js
	                                        //writeData("fs_person_reg", personData);	//fs_person_reg is table i.e store name
	                                        
	                                        //getting all the fields
									    add_new(
									    		Number(document.getElementById('breast1').checked),
									    		Number(document.getElementById('breast2').checked),
									    		Number(document.getElementById('breast3').checked),
									    		Number(document.getElementById('breast4').checked),
									    		Number(document.getElementById('breast5').checked),
									    		Number(document.getElementById('breast6').checked),
									    		Number(document.getElementById('breast7').checked)
												);
																	
	                                        console.log("Breast Data stored in idb...");
	                                        // if online it will be sent immediately by sync event and    
	                                        //if not online, display some proper message in the div id named 'output' 
	                                        if (!navigator.onLine) {
	                                            const output = document.getElementById('output');
	                                            output.innerHTML =
	                                                "FORM DATA SAVED AND WILL BE SENT LATER WHEN BACK ONLINE";
	                                            output.style.border = '2px solid red';
	                                            output.style.color = 'blue';
	                                            console.log("OFFLINE - so, if block worked");
	                                        } else {		//otherwise, if online, automatically synced 
	                                            // TO DO
	                                            // post form as we are online
	                                            const output = document.getElementById('output');
	                                            output.innerHTML =
	                                                "FORM DATA SENT";
	                                           output.style.border = '2px solid avocado';
	                                           output.style.color = 'green';
	                                           console.log("ONLINE - So, else block worked, data directly sent.");
	                                        }
	                                    });
	                                } else {
	                                	//if the browser does not support both serviceWorker and SyncManager, then post the form in a regular way
	                                    console.log("Browser does not support serviceWorker and SyncManager");
	                                	alert("does not support offline capability!!!!");
	                                }	
				

			});
	</script>
	
			<!-- <script src="scripts/js/app.js"></script>  -->
 	<script type="text/javascript" src="scripts/js/promise.js"></script>
	<script type="text/javascript" src="scripts/js/fetch.js"></script>
	<script type="text/javascript" src="scripts/js/app.js"></script>
	<script type="module" src="scripts/js/breastapp.js"></script>
	<script src="scripts/js/idb-init.js"></script>
</body>
</html>