<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Common Cancer Screening Survey Form</title>
	<link rel="stylesheet" type="text/css" href="scripts/assets/css/Others.css">
	<link rel="manifest" href="manifest.json">
	<script src="scripts/dexie/dexie.min.js"></script>
	<script src="scripts/dexie/dexie.js"></script>	
	<script src="scripts/js/gone-offline.js"></script>		
	<!--iOS support-->
	<link rel="apple-touch-icon" href="icons/icon-96.png">
	<meta name="apple-mobile-web-app-status-bar" content="#00695c">
	<meta name="theme-color" content="#00695c">
	<!--iOS support-->		
</head>




<body>
	<div class="container">

		<div class="title">
			Common Cancer Screening 
			<p style="float: right;"><a href="Menu.html">Menu</a></p> 
		</div>
		
		<div id="status"></div>
			<div class="form">
			<form name="patientForm">
			<div class="input-field">
				<label>1.Vomiting blood?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other1" id="other1">Yes
		                    <input type="radio" name="other1" id="other1">No
		                </td>															
            		</tr>
				</table>
			</div>						

			<div class="input-field">
				<label>2.Is there blood in the stool?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other2" id="other2">Yes
		                    <input type="radio" name="other2" id="other2">No
		                </td>															
            		</tr>
				</table>
			</div>	

			<div class="input-field">
				<label>3.Black stools, persistent constipation and diarrhoea - Does it happen</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other3" id="other3">Yes
		                    <input type="radio" name="other3" id="other3">No
		                </td>															
            		</tr>
				</table>
			</div>

			<div class="input-field">
				<label>4.Rapid weight loss?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other4" id="other4">Yes
		                    <input type="radio" name="other4" id="other4">No
		                </td>															
            		</tr>
				</table>
			</div>		

			<div class="input-field">
				<label>5.Does heartbum, indigestion, loss of appetite and abnormally bloated bowels occur?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other5" id="other5">Yes
		                    <input type="radio" name="other5" id="other5">No
		                </td>															
            		</tr>
				</table>
			</div>

			<div class="input-field">
				<label>6.Do body lumps, frickles and warts vary in color and size?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other6" id="other6">Yes
		                    <input type="radio" name="other6" id="other6">No
		                </td>															
            		</tr>
				</table>
			</div>		

			<div class="input-field">
				<label>7.Is there continuous noise?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other7" id="other7">Yes
		                    <input type="radio" name="other7" id="other7">No
		                </td>															
            		</tr>
				</table>
			</div>	

			<div class="input-field">
				<label>8.Continuous curl?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other8" id="other8">Yes
		                    <input type="radio" name="other8" id="other8">No
		                </td>															
            		</tr>
				</table>
			</div>

			<div class="input-field">
				<label>9.Bleeding from body orifices in common?</label>
				<table>
					<tr>               
		                <td>
		                    <input type="radio" name="other9" id="other9">Yes
		                    <input type="radio" name="other9" id="other9">No
		                </td>															
            		</tr>
				</table>
			</div>											

			<div class="btn-field">
				<input type="button" class="btn" id="prevbutton" onclick="BreastFn()" value="<<">
				<!-- <input type="submit" style='margin-right:16px' class="btn" value="SUBMIT">  -->
				<button id="submit" class="btn">SAVE</button>
				<input type="button" class="btn" value="CLEAR">
				<input type="button" class="btn" id="nextbutton" onclick="OverviewFn()" value=">>">
			</div>
			</form>		
			<div id="output" style="margin-top:20px;"></div>		
		</div>
	</div>
	<script>
		function BreastFn() {
			document.location.href="Breast.html"; 
		}
		
		function OverviewFn() {
			document.location.href="Overview.html"; /*Page name or Path*/ 
		}
	</script>	

	
			<script>
			
			//OLD CODE STARTS ----------------------------------------
			
			/*var db = new Dexie("DigiPathoFSDB");
			
			db.version(1).stores({
				fs_common_cancer_screening: "++fs_person_id, fs_cancer_id, vomiting_blood, stool_blood, abdominal_issue, rapid_weight_loss, abnormality_present, skin_problem, continuous_noise, is_curl, orifices_bleeding, user_id, created_date, is_valid"
			});
			
			//Log DB details -- opens an existing database as is
			db.open(); */
			
			/*var db = new Dexie("DigiPathoFSDB")
			  .open()
			  .then(function (db) {
			    console.log("Found database: " + db.name);
			    console.log("Database version: " + db.verno);
			    db.tables.forEach(function (table) {
			      console.log("Found table: " + table.name);
			      console.log("Table Schema: " + JSON.stringify(table.schema, null, 4));
			    });
			  })
			  .catch("NoSuchDatabaseError", function (e) {
			    // Database with that name did not exist
			    console.error("Database not found");
			  })
			  .catch(function (e) {
			    console.error("Oh uh: " + e);
			  });
			
			function add_new(other1, other2, other3, other4, other5, other6, other7, other8, other9){
			    // Interact With Database
			    db.transaction('rw', db.fs_common_cancer_screening, function () {
			        // Let's add some data to db:
			        insert_object = {
			        					vomiting_blood:other1, stool_blood:other2, abdominal_issue:other3, rapid_weight_loss:other4, abnormality_present:other5, skin_problem:other6, continuous_noise:other7, is_curl:other8, orifices_bleeding:other9		        												
									};
			        db.fs_common_cancer_screening.add(insert_object);
			    }).catch(function(err) {
			        console.error(err.stack || err);
			        console.log("ERROR");
			    });    
			}*/



			//add_new("susheel singh","susheel61@gmail.com");//default content
			//add_new("susheel singh","1987-09-28","35","Female","Married","944778932","SH2, Sulthan Bathery","4565545654","WARD2","PANCH5","DIST14","STA28","IND","689542","Doctor1","2022-09-27",true);//default content
			/*document.querySelector("button").addEventListener("click",function(e){
				//document.getElementById('submit').addEventListener('click', function (event) {
					//preventing default submission of the form
					//event.preventDefault();
					//console.log("Default event prevented!!!!");
					//console.log("button clicked");
			    add_new(
			    			document.getElementById('other1').checked,
			    			document.getElementById('other2').checked,
			    			document.getElementById('other3').checked,
			    			document.getElementById('other4').checked,
			    			document.getElementById('other5').checked,
			    			document.getElementById('other6').checked,
			    			document.getElementById('other7').checked,
			    	  		document.getElementById('other8').checked,
			    	  		document.getElementById('other9').checked
			    	  		
			    	  		Number(document.getElementById('other1').checked),
			    	  		Number(document.getElementById('other2').checked),
			    	  		Number(document.getElementById('other3').checked),
			    	  		Number(document.getElementById('other4').checked),
			    	  		Number(document.getElementById('other5').checked),
			    	  		Number(document.getElementById('other6').checked),
			    	  		Number(document.getElementById('other7').checked),
			    	  		Number(document.getElementById('other8').checked),
			    	  		Number(document.getElementById('other9').checked)
					);
			});*/
			
			//OLD CODE ENDS ----------------------------------------
			
					console.log("inside oral survey html script tag, for idb working");
		  
		//opening already created IDB
		var db = new Dexie("DigiPathoFSDB")
		  .open()
		  .then(function (db) {
		    console.log("Found database: " + db.name);
		    console.log("Database version: " + db.verno);
		    db.tables.forEach(function (table) {
		      console.log("Found table: " + table.name);
		      console.log("Table Schema: " + JSON.stringify(table.schema, null, 4));
		    });
		  })
		  .catch("NoSuchDatabaseError", function (e) {
		    // Database with that name did not exist
		    console.error("Database not found");
		  })
		  .catch(function (e) {
		    console.error("Oh uh: " + e);
		  });
		
		
			
			// form send event listener
			document.getElementById('submit').addEventListener('click', function (event) {
				//preventing default submission of the form
				event.preventDefault();
				console.log("Default event prevented!!!!");
				
			
				function add_new(other1, other2, other3, other4, other5, other6, other7, other8, other9){
				    // Interact With Database, fs_cervical_cancer_screening is one of the field names of IDB
				    db.transaction('rw', db.fs_common_cancer_screening_sync, function () {
				        // Let's add some data to db:
				        insert_object = {
				        					vomiting_blood:other1, stool_blood:other2, abdominal_issue:other3, 
				        					rapid_weight_loss:other4, abnormality_present:other5, skin_problem:other6, 
				        					continuous_noise:other7, is_curl:other8, orifices_bleeding:other9		        												
										};
				        db.fs_common_cancer_screening_sync.add(insert_object);
				    }).catch(function(err) {
				        console.error(err.stack || err);
				        console.log("ERROR OCCURRED when calling the form values and mappping with IDB fields");
				    });    
				}
			    

			//Background Sync code 
			
			//if the browser supports both serviceWorker and SyncManager, then carry on the further steps
			if ('serviceWorker' in navigator && 'SyncManager' in window) {
	                                    console.log("SYNC MANAGER AVAILABLE");
	                                  
	                                    // serviceWorker registered at top of page       
	                                    navigator.serviceWorker.ready.then(function (swRegistration) {
	                                        console.log("register sync fs_common_cancer_screening_sync_tag");
	                                        // REGISTER SYNC EVENT called fs_common_cancer_screening_sync_tag(our own custom name which should be unique to this particular background sync)
	                                        swRegistration.sync.register('fs_common_cancer_screening_sync_tag');

	                                        console.log("Saving to idb")
	                                        //writing data into IDB, function of idb-fn.js
	                                        //writeData("fs_person_reg", personData);	//fs_person_reg is table i.e store name
	                                        
	                                        //getting all the fields
										    add_new(
										    	  		Number(document.getElementById('other1').checked),
										    	  		Number(document.getElementById('other2').checked),
										    	  		Number(document.getElementById('other3').checked),
										    	  		Number(document.getElementById('other4').checked),
										    	  		Number(document.getElementById('other5').checked),
										    	  		Number(document.getElementById('other6').checked),
										    	  		Number(document.getElementById('other7').checked),
										    	  		Number(document.getElementById('other8').checked),
										    	  		Number(document.getElementById('other9').checked)
													);
																		
	                                        console.log("common cancer Data stored in idb...");
	                                        // if online it will be sent immediately by sync event and    
	                                        //if not online, display some proper message in the div id named 'output' 
	                                        if (!navigator.onLine) {
	                                            const output = document.getElementById('output');
	                                            output.innerHTML =
	                                                "FORM DATA SAVED AND WILL BE SENT LATER WHEN BACK ONLINE";
	                                            output.style.border = '2px solid red';
	                                            output.style.color = 'blue';
	                                            console.log("OFFLINE - so, if block worked");
	                                        } else {		//otherwise, if online, automatically synced 
	                                            // TO DO
	                                            // post form as we are online
	                                            const output = document.getElementById('output');
	                                            output.innerHTML =
	                                                "FORM DATA SENT";
	                                           output.style.border = '2px solid avocado';
	                                           output.style.color = 'green';
	                                           console.log("ONLINE - So, else block worked, data directly sent.");
	                                        }
	                                    });
	                                } else {
	                                	//if the browser does not support both serviceWorker and SyncManager, then post the form in a regular way
	                                    console.log("Browser does not support serviceWorker and SyncManager");
	                                	alert("does not support offline capability!!!!");
	                                }	
				

			});
			
	</script>
	
			<!-- <script src="scripts/js/app.js"></script>  -->
 	<script type="text/javascript" src="scripts/js/promise.js"></script>
	<script type="text/javascript" src="scripts/js/fetch.js"></script>
	<script type="text/javascript" src="scripts/js/app.js"></script>
	<script type="module" src="scripts/js/othersapp.js"></script>
	<script src="scripts/js/idb-init.js"></script>
</body>
</html>